---------------------------------------------------------------------------------
-----------------------------SECUENCIAS------------------------------------------
---------------------------------------------------------------------------------

-- DE ACUERDO A LO SOLICITADO POR EL REQUERIMIENTO DE LA LÁMINA "CLASE 2"

-- GENERA LA SECUENCIA

-- ESTUDIANTES: DEBEN SER CAPACES INDEPENDIENTE DE LA FLEXIBILIDAD QUE SE OTORGUE,
-- DE ESTIMAR EL MAX_VALUE.


-- CONSIDERANDO USUARIOS A GENERAR PARA LA CARRERA ICI: DEBO CONSIDERAR, QUE 
-- ACTUALMENTE EXISTEN 650 ESTUDIANTES, EN UNA PROYECCION A 10 AÑOS CON NUEVOS ESTUDIANTES
-- CONSIDERANDO, UN INGRESO ANUAL DE 140 ESTUDIANTES, CON UNA TASA DE CRECIMIENTO DEL 5% Y 
-- UN REDONDEO HACIA ARRIBA, SUPONDRÉ UN VALOR EQUIVALENTE A 2500 USUARIOS. 


CREATE SEQUENCE CACB_PK_USUARIO
	START WITH 1
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2500
	CACHE 200
	NOCYCLE;


--- SE MEZCLA EL PA CON LA SECUENCIA


CREATE OR REPLACE PROCEDURE CACB_CARGA_USUARIOS(
	NOMBRE_USUARIO_P VARCHAR2,
	APELLIDO1_USUARIO_P VARCHAR2,
	APELLIDO2_USUARIO_P VARCHAR2
)
IS
BEGIN
	LOCK TABLE CACB_USUARIO IN ROW EXCLUSIVE MODE;
	INSERT INTO CACB_USUARIO(COD_USUARIO, NOMBRE_USUARIO, APELLIDO1_USUARIO, APELLIDO2_USUARIO)
	VALUES(CACB_PK_USUARIO.NEXTVAL, NOMBRE_USUARIO_P, APELLIDO1_USUARIO_P, APELLIDO2_USUARIO_P);
	COMMIT;
	EXCEPTION
		WHEN PROGRAM_ERROR THEN
			RAISE_APPLICATION_ERROR(-6501,'ERROR INTERNO DEL PROGRAMA');
		WHEN OTHERS THEN
			RAISE_APPLICATION_ERROR(-20010,'UPSI FALLÉ =(');
		ROLLBACK;
END;


--- SE COMPILA Y PRUEBA PA

BEGIN
	DELETE FROM CACB_USUARIO;
	CACB_CARGA_USUARIOS('CARLOS','CASTRO','BUSTAMANTE');
	CACB_CARGA_USUARIOS('JUAN','PEREZ','REYES');
END;


SELECT * FROM CACB_USUARIO;